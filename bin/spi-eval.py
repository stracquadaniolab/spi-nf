#!/usr/bin/env python
import os
import argparse
import json
import time

import numpy as np

from libspi.Genome import *
from libspi.MonteCarloSampler import *
from libspi.ProfileEvaluator import *

import libspi.IO as IO
import libspi.CommandLineUtils as cli

##############################################################
###### CMD line options parser
##############################################################
def parse_command_line_options():
    parser = argparse.ArgumentParser(description='Evaluate profile generated by Monte Carlo sampling.')
    parser.add_argument('--input-file', '-i', type=str, help="Genome file.")
    parser.add_argument('--profile-file', '-p', type=str, help="Profile file.")
    parser.add_argument('--output-file', '-o', type=str, required=True, help="Profile output file.")
    parser.add_argument('--training-file', '-t', type=str, required=True, help="Training dataset file.")
    options = parser.parse_args()
    return options


##############################################################
###### MAIN method
##############################################################
if __name__ == "__main__":
    #
    options = parse_command_line_options()

    # creating and loading genome structure file
    genome = Genome()
    genome.load_genome_from_file(options.input_file)

    ms = BinomialLogLikEvaluator(genome)
    ms.load_training_dataset_from_file(options.training_file)

    profiles = IO.load_profiles_from_file(options.profile_file)
    results = ms.evaluate(profiles)

    IO.save_profile_evaluation_to_file(options.output_file, results, vars(options))
